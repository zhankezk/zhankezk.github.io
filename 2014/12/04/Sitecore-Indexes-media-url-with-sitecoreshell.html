<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
		<head>
		<meta content="en-au" http-equiv="Content-Language" />
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Blog Feed" />
		<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Blog Feed" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<title>Sitecore Indexes media url with /sitecore/shell</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css" />
		<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/8.4/styles/default.min.css">
		<link rel="shortcut icon" href="/img/favicon.ico" />
	</head>

	<body>
	    <!-- Google Tag Manager -->
		<noscript>
			<iframe src="//www.googletagmanager.com/ns.html?id=GTM-TQXXF7"
					height="0" width="0" style="display:none;visibility:hidden"></iframe>
		</noscript>
		<script>
			(function (w, d, s, l, i) {
				w[l] = w[l] || []; w[l].push({
					'gtm.start':
					new Date().getTime(), event: 'gtm.js'
				}); var f = d.getElementsByTagName(s)[0],
				j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
				'//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
			})(window, document, 'script', 'dataLayer', 'GTM-TQXXF7');</script>
		<!-- End Google Tag Manager -->
		<script type="text/javascript">  var appInsights=window.appInsights||function(config){    function r(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},u=document,e=window,o="script",s=u.createElement(o),i,f;for(s.src=config.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",u.getElementsByTagName(o)[0].parentNode.appendChild(s),t.cookie=u.cookie,t.queue=[],i=["Event","Exception","Metric","PageView","Trace"];i.length;)r("track"+i.pop());return r("setAuthenticatedUserContext"),r("clearAuthenticatedUserContext"),config.disableExceptionTracking||(i="onerror",r("_"+i),f=e[i],e[i]=function(config,r,u,e,o){var s=f&&f(config,r,u,e,o);return s!==!0&&t["_"+i](config,r,u,e,o),s}),t    }({        instrumentationKey:"87fb325d-c796-4ef5-9497-fcef28dc8564"    });           window.appInsights=appInsights;    appInsights.trackPageView();</script>
		<div id="container">
			<div id="side">
				<div id="hometext"><a href="/" id="home" title="Kb" alt="Kb">Kb</a></div>
				<div class="section">
					<ul>
						<li><a href="/Siigaa.html">西瓜跟踪<br/>Siigaa Tracker</a></li>
						<li>&nbsp;</li>
						<li><a href="/rss.xml"><img src="/img/25.png" /> feed</a></li>
						<li><a href="http://mdyard.azurewebsites.net/">&nbsp;&nbsp;&nbsp;&nbsp;</a></li>
					</ul>
				</div>
			</div>
			<div id="content">
				<div class="entry-container">
	<div class='entry'>
		<h1> Sitecore Indexes media url with /sitecore/shell </h1>
		<span class="postdate"> 4 December, 2014
			
		</span>
		<pre><code>	&lt;p&gt;&quot;urllink&quot; is a ComputedIndexField in Sitecore indexs.&lt;/p&gt;
</code></pre>
<p>For media items, if I rebuild the indexs, the urls that gets stored into index start with "/~/media/...", which is correct.</p>
<p>But if the index strategy is onPublishEndSync, and I do republish on my media items, the urls start with "/sitecore/shell/~/media/...".</p>
<p>I've checked Sitecore source code, the difference is Context.Site. it's null when rebuilding the index, so it uses "/" as prefix. but it's "Sitecore shell" when doing publishing. Therefore it's using Context.Site.VirtualFolder of Sitecore Shell, which is "/sitecore/shell".</p>
<p>I think this is a Sitecore bug. ATM I'm thinking to create my own urlLink ComputedIndexField class and use MediaUrlOptions with AbsolutePath=false as a fix.</p>
<p>Requested Sitecore Support for help. Tested the fix for now, works fine.</p>
<p><em><strong>Update 1 - 08/12/2014</strong></em></p>
<p>Sitecore confirmed it's a bug, however second response came back changed to saying this is expected behavior, I'm not happy with the response yet, stilling discussing.</p>
<p><em><strong>Update 2 - 15/12/2014</strong></em></p>
<p>Ticket's closed now. Sitecore's solution is to remove this "urlLink" field from the index in the future(They said they will request this).</p>
<p>Reason being that url should be generated by LinkManager based on current site context. However site context doesn't exist while indexing(For content item you can check the path, but for media item you cannot).</p>
<p>Of course there's another solution is to create your own computeredField to override the logic for media item. However I agree with Sitecore, it feels more right to remove this field from the index.</p>
<p>On top of all that, the initial reason for using the urlLink field was to drop the need for querying Sitecore completely while doing a Search. All the content are coming from Index's stored fields value. But on the other hand, pagination is normally being used for search results, so even there're requests to Sitecore, it shouldn't be a lot.</p>
<p>That'd be all for now, happy to see more opinions and to discuss, thanks!</p>
	</div>
</div>
<div id="page-navigation"> 
	<div class="left">  <a href="/2014/10/12/IIS-Http-error-50019-with-webconfig.html" title="Previous Post: IIS Http error 500.19 with web.config">&larr; IIS Http error 500.19 with web.config</a>  </div> 
	<div class="right">  <a href="/2014/12/07/Sitecore-Redirect-Manager.html" title="next Post: Sitecore Redirect Manager">Sitecore Redirect Manager &rarr; </a>  </div> 
	<div class="clear">&nbsp;</div>
</div> 



<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'kezblog'; 
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

			</div>
		</div>
		<script src="//cdn.jsdelivr.net/highlight.js/8.4/highlight.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</body>
</html>