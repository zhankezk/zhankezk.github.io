<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
		<head>
		<meta content="en-au" http-equiv="Content-Language" />
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Blog Feed" />
		<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Blog Feed" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<title>Common Causes and Troubleshooting Sitecore App Restarts on Azure Web App Services</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css" />
		<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/8.4/styles/default.min.css">
		<link rel="shortcut icon" href="/img/favicon.ico" />
	</head>

	<body>
	    <!-- Google Tag Manager -->
		<noscript>
			<iframe src="//www.googletagmanager.com/ns.html?id=GTM-TQXXF7"
					height="0" width="0" style="display:none;visibility:hidden"></iframe>
		</noscript>
		<script>
			(function (w, d, s, l, i) {
				w[l] = w[l] || []; w[l].push({
					'gtm.start':
					new Date().getTime(), event: 'gtm.js'
				}); var f = d.getElementsByTagName(s)[0],
				j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
				'//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
			})(window, document, 'script', 'dataLayer', 'GTM-TQXXF7');</script>
		<!-- End Google Tag Manager -->
		<script type="text/javascript">  var appInsights=window.appInsights||function(config){    function r(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},u=document,e=window,o="script",s=u.createElement(o),i,f;for(s.src=config.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",u.getElementsByTagName(o)[0].parentNode.appendChild(s),t.cookie=u.cookie,t.queue=[],i=["Event","Exception","Metric","PageView","Trace"];i.length;)r("track"+i.pop());return r("setAuthenticatedUserContext"),r("clearAuthenticatedUserContext"),config.disableExceptionTracking||(i="onerror",r("_"+i),f=e[i],e[i]=function(config,r,u,e,o){var s=f&&f(config,r,u,e,o);return s!==!0&&t["_"+i](config,r,u,e,o),s}),t    }({        instrumentationKey:"87fb325d-c796-4ef5-9497-fcef28dc8564"    });           window.appInsights=appInsights;    appInsights.trackPageView();</script>
		<div id="container">
			<div id="side">
				<div id="hometext"><a href="/" id="home" title="KB" alt="KB">KB</a></div>
				<div class="section">
					<ul>
						<li><a href="/rss.xml"><img src="/img/25.png" /> feed</a></li>
						<li><a href="https://mdyard.azurewebsites.net/">&nbsp;&nbsp;&nbsp;&nbsp;</a></li>
					</ul>
				</div>
			</div>
			<div id="content">
				<div class="entry-container">
	<div class='entry'>
		<h1> Common Causes and Troubleshooting Sitecore App Restarts on Azure Web App Services </h1>
		<span class="postdate">28 April, 2019
			
		</span>
		<?xml version='1.0' encoding='UTF-8'?>  <!DOCTYPE body SYSTEM 'http://xml.evernote.com/pub/enml2.dtd'>    <body><div><div>This post is divided into 2 parts, the first part will go through some common causes that lead to random Sitecore app pool restarts on Azure App Services. The second part will provide some useful troubleshooting approaches to identify the causes.</div><div><br/></div><div><span style='font-weight: bold; font-size: 14pt;'>Common Causes</span></div><ul><li><div><font style='font-size: 12pt;'>Website Dynamic Cache is enabled</font></div><div>Please ref to this Sitecore Knowledge Base article for more detail on how to turn off Website Dynamic Cache for Sitecore apps hosted on Azure Web App Services:&nbsp; <a target="_blank" href='https://kb.sitecore.net/articles/983839'>https://kb.sitecore.net/articles/983839</a></div></li></ul><ul><li><div><font style='font-size: 12pt;'><span style='color: rgb(28, 41, 51); font-family: sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.5);'>File Change Notification (FCN)&nbsp;</span>is enabled</font></div><div><span style='orphans: 2; text-indent: 0px; widows: 2; background-color: rgba(255, 255, 255, 0.5);'><font style='font-family: sans-serif; color: rgb(28, 41, 51);'>This was provided by Sitecore support as a solution when our app kept on crashing even after setting Website Dynamic Cache to false in Azure. The change is basically web.config change on</font></span> <span style='color: rgb(28, 41, 51); font-family: sans-serif; font-size: 13px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.5);'>&lt;httpRuntime fcnMode=&quot;Disabled&quot; .../&gt;. The o</span><span style='orphans: 2; text-indent: 0px; widows: 2; background-color: rgba(255, 255, 255, 0.5);'><font color='#1C2933' face='sans-serif'>riginal&nbsp;Reference is:&nbsp;</font></span> <span style='color: rgb(28, 41, 51); font-family: sans-serif; font-size: 13px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.5);'><a target="_blank" href='https://shazwazza.com/post/all-about-aspnet-file-change-notification-fcn/'>https://shazwazza.com/post/all-about-aspnet-file-change-notification-fcn/</a></span></div><div><font color='#1C2933'>In addition, Sitecore support suggested increasing number for&nbsp;</font><span style='color: rgb(28, 41, 51);'>numRecomplesBeforeAppRestart in web.config like this:&nbsp;</span> <span style='color: rgb(28, 41, 51); font-family: sans-serif; font-size: 13px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.5);'>&lt;compilation defaultLanguage=&quot;c#&quot; debug=&quot;false&quot; targetFramework=&quot;4.5.2&quot;</span><span style='color: rgb(28, 41, 51); font-family: sans-serif; font-size: 13px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.5);'>&nbsp;</span><span style='font-weight: bold; box-sizing: border-box; color: rgb(28, 41, 51); font-family: sans-serif; font-size: 13px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.5);'>numRecompilesBeforeAppRestart=&quot;999&quot;</span><span style='color: rgb(28, 41, 51); font-family: sans-serif; font-size: 13px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.5);'>&gt;</span></div></li></ul><ul><li><div><font style='font-size: 12pt;'>Auto Heal is on</font></div><div>This needs to be set specifically so it&apos;s not on by default. References can be found here:&nbsp; <a target="_blank" href='https://azure.microsoft.com/en-us/blog/auto-healing-windows-azure-web-sites/'>https://azure.microsoft.com/en-us/blog/auto-healing-windows-azure-web-sites/</a>&nbsp;and looks like it can also be done from KUDO:&nbsp; <a target="_blank" href='https://benperk.github.io/waws/2015/2015-11-auto-heal-your-azure-web-app.html'>https://benperk.github.io/waws/2015/2015-11-auto-heal-your-azure-web-app.html</a></div></li><li><div><font style='font-size: 12pt;'>Proactive Auto Heal is on</font></div><div>This is normally on by default for all Azure web apps. However it&apos;s not that easy to be triggered, if this is the real reasons that your app is restarting, you have bigger problems to solve then just the random restarts.&nbsp;</div><div>Reference can be found here:&nbsp; <a target="_blank" href='https://koukia.ca/proactive-auto-heal-on-azure-app-services-8d136d7e894e'>https://koukia.ca/proactive-auto-heal-on-azure-app-services-8d136d7e894e</a></div></li><li><div><font style='font-size: 12pt;'>Always on is not on</font></div><div>This should be enabled by default if your instance is above certain level of pricing tier. More details can be found here:&nbsp; <a target="_blank" href='https://docs.microsoft.com/en-us/azure/app-service/configure-common'>https://docs.microsoft.com/en-us/azure/app-service/configure-common</a>. It disables both periodic recycle and idle timeout recycle.&nbsp;</div></li></ul><div><font style='font-size: 14pt;'><br/></font></div><div><span style='font-weight: bold; font-size: 14pt;'>Some troubleshoot approaches</span></div><ul><li><div><font style='font-size: 12pt;'>Web App Restarted tab</font></div><div>In your Azure Web App &quot;Diagnose and solve problems&quot; tab, search for &quot;Web App Restarted&quot;. It can provide you details of why the app restarted including Azure maintenance information, which is very good information when sometimes you looked everywhere and couldn&apos;t see why the app was restarted.&nbsp;</div></li><li><div><font style='font-size: 12pt;'>Event logs</font></div><div>In the same tab above, search for &quot;Application Events&quot;. You can also find the raw xml files by using FTP into the application, but this is a much easier way to troubleshoot.</div></li><li><div><font style='font-size: 12pt;'>Sitecore logs</font></div><div>This official Knowledge Base article provides a full picture for Sitecore log viewing in Azure:&nbsp;<a target="_blank" href='https://kb.sitecore.net/articles/911837'>https://kb.sitecore.net/articles/911837</a></div><div>Don&apos;t want to repeat the same things, just some additional notes here:</div></li><ul><li><div>If &quot;Application Logging (Filesystem)&quot; is enabled in &quot;App Service Logs&quot; tab, Live logs can be viewed from &quot;Log Stream&quot; tab. Server logs can be viewed following the same way which is helpful when the issue is on IIS or .Net level.</div></li><li><div>Other than Analytics in Application Insight, you can use &quot;Search&quot; to see latest traces as well. However you will have more controls in Analytics by using queries.&nbsp;</div></li><li><div><a target="_blank" href='https://kb.sitecore.net/Services/Tracking/TrackEvent?ev=ap49qjWLPCqIf%2f44yz5vq28lfFHw6%2bqhjw7bOSTnHZWjsn9Z%2boAk%2bELNVDh0Jzvf4NfRl2lvcTK84KlTkK19lHd3pi1pwj72gKuMsOeP7aLIDfxMFotMrVCGkjDli7rpjUC8YgNoOtBy0my1CEYu5LGj8AJBiBMke%2brsrLdN%2bUM%3d'>AzureTools.aspx</a>&nbsp;is the latest helper page Sitecore provides to view Sitecore logs by using Azure Application Insights REST apis. It also supports Azure Search. There is an older version which is more light weight and works without requiring an IIS/.Net environment can be downloaded here:&nbsp;<a target="_blank" href='https://kb.sitecore.net/~/media/182E0EA7E5614BB3B3EADB9B61440EAD.ashx?la=en'>AzureAILogs.html</a>. You can also modify the html and save app ID and key direct with the file, then just place it in your CM Sitecore Admin folder. So you can use it just like how you use logs.aspx before. (Note, make sure security is applied before it&apos;s exposed like this)</div></li></ul></ul><div><br/></div></div><div><br/></div>
	</div>
</div>
<div id="page-navigation"> 
	<div class="left">  <a href="/2019/04/09/Sitecore-91-Initial-Release-with-Identify-Server-User-Boost-Feature-Patch.html" title="Previous Post: Sitecore 9.1 Initial Release with Identify Server User Boost Feature Patch">&larr; Sitecore 9.1 Initial Release with Identify Server User Boost Feature Patch</a>  </div> 
	<div class="right">  </div> 
	<div class="clear">&nbsp;</div>
</div> 



<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'kezblog'; 
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="//disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

			</div>
		</div>
		<script src="//cdn.jsdelivr.net/highlight.js/8.4/highlight.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</body>
</html>