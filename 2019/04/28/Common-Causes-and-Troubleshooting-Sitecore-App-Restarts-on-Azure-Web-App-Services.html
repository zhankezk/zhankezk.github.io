<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
		<head>
		<meta content="en-au" http-equiv="Content-Language" />
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Blog Feed" />
		<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Blog Feed" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<title>Common Causes and Troubleshooting Sitecore App Restarts on Azure Web App Services</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css" />
		<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/8.4/styles/default.min.css">
		<link rel="shortcut icon" href="/img/favicon.ico" />
		<script  type="text/javascript">
		    if (location.protocol != 'https:')
            {
             location.href = 'https:' + window.location.href.substring(window.location.protocol.length);
            }
		</script>
	</head>

	<body>
	    <!-- Google Tag Manager -->
		<noscript>
			<iframe src="//www.googletagmanager.com/ns.html?id=GTM-TQXXF7"
					height="0" width="0" style="display:none;visibility:hidden"></iframe>
		</noscript>
		<script>
			(function (w, d, s, l, i) {
				w[l] = w[l] || []; w[l].push({
					'gtm.start':
					new Date().getTime(), event: 'gtm.js'
				}); var f = d.getElementsByTagName(s)[0],
				j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
				'//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
			})(window, document, 'script', 'dataLayer', 'GTM-TQXXF7');</script>
		<!-- End Google Tag Manager -->
		<script type="text/javascript">  var appInsights=window.appInsights||function(config){    function r(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},u=document,e=window,o="script",s=u.createElement(o),i,f;for(s.src=config.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",u.getElementsByTagName(o)[0].parentNode.appendChild(s),t.cookie=u.cookie,t.queue=[],i=["Event","Exception","Metric","PageView","Trace"];i.length;)r("track"+i.pop());return r("setAuthenticatedUserContext"),r("clearAuthenticatedUserContext"),config.disableExceptionTracking||(i="onerror",r("_"+i),f=e[i],e[i]=function(config,r,u,e,o){var s=f&&f(config,r,u,e,o);return s!==!0&&t["_"+i](config,r,u,e,o),s}),t    }({        instrumentationKey:"87fb325d-c796-4ef5-9497-fcef28dc8564"    });           window.appInsights=appInsights;    appInsights.trackPageView();</script>
		<div id="container">
			<div id="side">
				<div id="hometext"><a href="/" id="home" title="KB" alt="KB">KB</a></div>
				<div class="section">
					<ul>
						<li><a href="/rss.xml"><img src="/img/25.png" /> feed</a></li>
						<li><a href="https://mdyard.azurewebsites.net/">&nbsp;&nbsp;&nbsp;&nbsp;</a></li>
					</ul>
				</div>
			</div>
			<div id="content">
				<div class="entry-container">
	<div class='entry'>
		<h1> Common Causes and Troubleshooting Sitecore App Restarts on Azure Web App Services </h1>
		<span class="postdate">28 April, 2019
			
		</span>
		<div><div><span style='font-family: &quot;Helvetica Neue&quot;;'>This post is divided into 2 parts, the first part will go through some common causes that lead to random Sitecore app pool restarts on Azure App Services. The second part will provide some useful troubleshooting approaches to identify the causes.</span></div><div><br /></div><div><span style='font-size: 14pt;'><span style='font-size: 14pt; font-weight: bold; font-family: &quot;Helvetica Neue&quot;;'>Common Causes</span></span></div><ul><li><div><span style='font-size: 12pt;'><span style='font-size: 12pt; font-family: &quot;Helvetica Neue&quot;;'>Website Dynamic Cache is enabled</span></span></div><div><span style='font-family: &quot;Helvetica Neue&quot;;'>Please ref to this Sitecore Knowledge Base article for more detail on how to turn off Website Dynamic Cache for Sitecore apps hosted on Azure Web App Services:&nbsp; </span><a target="_blank" href='https://kb.sitecore.net/articles/983839' style='font-family: &quot;Helvetica Neue&quot;;'>https://kb.sitecore.net/articles/983839</a></div></li><li><div><span style='letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.498039); font-size: 12pt; font-family: &quot;Helvetica Neue&quot;; color: rgb(28, 41, 51); font-variant-caps: normal; font-variant-ligatures: normal;'>File Change Notification (FCN)&nbsp;</span><span style='font-size: 12pt; font-family: &quot;Helvetica Neue&quot;;'>is enabled</span></div><div><span style='orphans: 2; text-indent: 0px; widows: 2; background-color: rgba(255, 255, 255, 0.498039);'><span style='background-color: rgba(255, 255, 255, 0.498039); font-family: &quot;Helvetica Neue&quot;; font-size: 14px; color: rgb(28, 41, 51);'>This was provided by Sitecore support as a solution when our app kept on crashing even after setting Website Dynamic Cache to false in Azure. The change is basically web.config change on</span></span><span style='font-family: &quot;Helvetica Neue&quot;; font-size: 14px;'> </span><span style='letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.498039); font-family: &quot;Helvetica Neue&quot;; font-size: 14px; color: rgb(28, 41, 51); font-variant-caps: normal; font-variant-ligatures: normal;'>&lt;httpRuntime fcnMode='Disabled' .../&gt;. The o</span><span style='orphans: 2; text-indent: 0px; widows: 2; background-color: rgba(255, 255, 255, 0.498039);'><span style='background-color: rgba(255, 255, 255, 0.498039); font-family: &quot;Helvetica Neue&quot;; font-size: 14px; color: rgb(28, 41, 51);'>riginal&nbsp;Reference is:&nbsp;</span></span><span style='font-family: &quot;Helvetica Neue&quot;; font-size: 14px;'> </span><span style='letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.498039);'><a target="_blank" href='https://shazwazza.com/post/all-about-aspnet-file-change-notification-fcn/' style='background-color: rgba(255, 255, 255, 0.498039); font-family: &quot;Helvetica Neue&quot;; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal;'>https://shazwazza.com/post/all-about-aspnet-file-change-notification-fcn/</a></span></div><div><span style='font-family: &quot;Helvetica Neue&quot;; font-size: 14px; color: rgb(28, 41, 51);'>In addition, Sitecore support suggested increasing number for&nbsp;</span><span style='font-family: &quot;Helvetica Neue&quot;; font-size: 14px; color: rgb(28, 41, 51);'>numRecomplesBeforeAppRestart in web.config like this:&nbsp;</span><span style='font-family: &quot;Helvetica Neue&quot;; font-size: 14px;'> </span><span style='letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.498039); font-family: &quot;Helvetica Neue&quot;; font-size: 14px; color: rgb(28, 41, 51); font-variant-caps: normal; font-variant-ligatures: normal;'>&lt;compilation defaultLanguage='c#' debug='false' targetFramework='4.5.2'</span><span style='letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.498039); font-family: &quot;Helvetica Neue&quot;; font-size: 14px; color: rgb(28, 41, 51); font-variant-caps: normal; font-variant-ligatures: normal;'>&nbsp;</span><span style='box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.498039); font-family: &quot;Helvetica Neue&quot;; font-size: 14px; color: rgb(28, 41, 51); font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;'>numRecompilesBeforeAppRestart='999'</span><span style='letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(255, 255, 255, 0.498039); font-family: &quot;Helvetica Neue&quot;; font-size: 14px; color: rgb(28, 41, 51); font-variant-caps: normal; font-variant-ligatures: normal;'>&gt;</span></div></li><li><div><span style='font-size: 12pt;'><span style='font-size: 12pt; font-family: &quot;Helvetica Neue&quot;;'>Auto Heal is on</span></span></div><div><span style='font-family: &quot;Helvetica Neue&quot;;'>This needs to be set specifically so it's not on by default. References can be found here:&nbsp; </span><a target="_blank" href='https://azure.microsoft.com/en-us/blog/auto-healing-windows-azure-web-sites/' style='font-family: &quot;Helvetica Neue&quot;;'>https://azure.microsoft.com/en-us/blog/auto-healing-windows-azure-web-sites/</a><span style='font-family: &quot;Helvetica Neue&quot;;'>&nbsp;and looks like it can also be done from KUDO:&nbsp; </span><a target="_blank" href='https://benperk.github.io/waws/2015/2015-11-auto-heal-your-azure-web-app.html' style='font-family: &quot;Helvetica Neue&quot;;'>https://benperk.github.io/waws/2015/2015-11-auto-heal-your-azure-web-app.html</a></div></li><li><div><span style='font-size: 12pt;'><span style='font-size: 12pt; font-family: &quot;Helvetica Neue&quot;;'>Proactive Auto Heal is on</span></span></div><div><span style='font-family: &quot;Helvetica Neue&quot;;'>This is normally on by default for all Azure web apps. However it's not that easy to be triggered, if this is the real reasons that your app is restarting, you have bigger problems to solve than just the random restarts.&nbsp;</span></div><div><span style='font-family: &quot;Helvetica Neue&quot;;'>Reference can be found here:&nbsp; </span><a target="_blank" href='https://koukia.ca/proactive-auto-heal-on-azure-app-services-8d136d7e894e' style='font-family: &quot;Helvetica Neue&quot;;'>https://koukia.ca/proactive-auto-heal-on-azure-app-services-8d136d7e894e</a></div></li><li><div><span style='font-size: 12pt;'><span style='font-size: 12pt; font-family: &quot;Helvetica Neue&quot;;'>Always on is not on</span></span></div><div><span style='font-family: &quot;Helvetica Neue&quot;;'>This should be enabled by default if your instance is above certain level of pricing tier. More details can be found here:&nbsp; </span><a target="_blank" href='https://docs.microsoft.com/en-us/azure/app-service/configure-common' style='font-family: &quot;Helvetica Neue&quot;;'>https://docs.microsoft.com/en-us/azure/app-service/configure-common</a><span style='font-family: &quot;Helvetica Neue&quot;;'>. It disables both periodic recycle and idle timeout recycle.&nbsp;</span></div></li><li><div><font face='Helvetica Neue' style='font-size: 16px;'>Azure Maintainance</font></div><div><font style='font-size: 14px;'>Yep, Azure machines need to be restarted sometime too 😉 If you app is a single instance, this most likely happens during Azure maintenance, Azure moves your app to a new instance however the starting process still occurs.</font></div><div>Those platform upgrades and restarts normally can be found when you use Web App Restarted tab mentioned below. One way to avoid this is to make sure that you have multiple instances, as Microsoft stated, they won’t apply at the same time to all the apps in the same plan:&nbsp;<a target="_blank" href='https://feedback.azure.com/forums/169385-web-apps/suggestions/37746457-high-availability-app-service'>https://feedback.azure.com/forums/169385-web-apps/suggestions/37746457-high-availability-app-service</a>. Another way to reduce the impact is to use App Initialisation Module. Please see more details here:&nbsp;<a target="_blank" href='https://ruslany.net/2015/09/how-to-warm-up-azure-web-app-during-deployment-slots-swap/'>https://ruslany.net/2015/09/how-to-warm-up-azure-web-app-during-deployment-slots-swap/</a></div></li></ul><div><font style='font-size: 14pt;' face='Helvetica Neue'><br /></font></div><div><span style='font-size: 14pt;'><span style='font-size: 14pt; font-weight: bold; font-family: &quot;Helvetica Neue&quot;;'>Some troubleshoot approaches</span></span></div><ul><li><div><span style='font-size: 12pt;'><span style='font-size: 12pt; font-family: &quot;Helvetica Neue&quot;;'>Web App Restarted tab</span></span></div><div><span style='font-family: &quot;Helvetica Neue&quot;;'>In your Azure Web App 'Diagnose and solve problems' tab, search for 'Web App Restarted'. It can provide you details of why the app restarted including Azure maintenance information, which is very good information when sometimes you looked everywhere and couldn't see why the app was restarted.&nbsp;</span></div></li><li><div><span style='font-size: 12pt;'><span style='font-size: 12pt; font-family: &quot;Helvetica Neue&quot;;'>Event logs</span></span></div><div><span style='font-family: &quot;Helvetica Neue&quot;;'>In the same tab above, search for 'Application Events'. You can also find the raw xml files by using FTP into the application, but this is a much easier way to troubleshoot.</span></div></li><li><div><span style='font-size: 12pt;'><span style='font-size: 12pt; font-family: &quot;Helvetica Neue&quot;;'>Sitecore logs</span></span></div><div><span style='font-family: &quot;Helvetica Neue&quot;;'>This official Knowledge Base article provides a full picture for Sitecore log viewing in Azure:&nbsp;</span><a target="_blank" href='https://kb.sitecore.net/articles/911837' style='font-family: &quot;Helvetica Neue&quot;;'>https://kb.sitecore.net/articles/911837</a></div><div><span style='font-family: &quot;Helvetica Neue&quot;;'>Don't want to repeat the same things, just some additional notes here:</span></div></li><ul><li><div><span style='font-family: &quot;Helvetica Neue&quot;;'>If 'Application Logging (Filesystem)' is enabled in 'App Service Logs' tab, Live logs can be viewed from 'Log Stream' tab. Server logs can be viewed following the same way which is helpful when the issue is on IIS or .Net level.</span></div></li><li><div><span style='font-family: &quot;Helvetica Neue&quot;;'>Other than Analytics in Application Insight, you can use 'Search' to see latest traces as well. However you will have more controls in Analytics by using queries.&nbsp;</span></div></li><li><div><a target="_blank" href='https://kb.sitecore.net/Services/Tracking/TrackEvent?ev=ap49qjWLPCqIf%2f44yz5vq28lfFHw6%2bqhjw7bOSTnHZWjsn9Z%2boAk%2bELNVDh0Jzvf4NfRl2lvcTK84KlTkK19lHd3pi1pwj72gKuMsOeP7aLIDfxMFotMrVCGkjDli7rpjUC8YgNoOtBy0my1CEYu5LGj8AJBiBMke%2brsrLdN%2bUM%3d' style='font-family: &quot;Helvetica Neue&quot;;'>AzureTools.aspx</a><span style='font-family: &quot;Helvetica Neue&quot;;'>&nbsp;is the latest helper page Sitecore provides to view Sitecore logs by using Azure Application Insights REST apis. It also supports Azure Search. There is an older version which is more light weight and works without requiring an IIS/.Net environment can be downloaded here:&nbsp;</span><a target="_blank" href='https://kb.sitecore.net/~/media/182E0EA7E5614BB3B3EADB9B61440EAD.ashx?la=en' style='font-family: &quot;Helvetica Neue&quot;;'>AzureAILogs.html</a><span style='font-family: &quot;Helvetica Neue&quot;;'>. You can also modify the html and save app ID and key direct with the file, then just place it in your CM Sitecore Admin folder. So you can use it just like how you use logs.aspx before. (Note, make sure security is applied before it's exposed like this)</span></div></li></ul></ul><div><br /></div></div><div><br /></div>
	</div>
</div>
<div id="page-navigation"> 
	<div class="left">  <a href="/2019/04/09/Sitecore-91-Initial-Release-with-Identify-Server-User-Boost-Feature-Patch.html" title="Previous Post: Sitecore 9.1 Initial Release with Identify Server User Boost Feature Patch">&larr; Sitecore 9.1 Initial Release with Identify Server User Boost Feature Patch</a>  </div> 
	<div class="right">  <a href="/2019/09/11/Model-Rendering-Variant-doesnt-work-with-custom-Sitecore-SXA-rendering.html" title="next Post: Model Rendering Variant doesnt work with custom Sitecore SXA rendering">Model Rendering Variant doesnt work with custom Sitecore SXA rendering &rarr; </a>  </div> 
	<div class="clear">&nbsp;</div>
</div> 



<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'kezblog'; 
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="//disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

			</div>
		</div>
		<script src="//cdn.jsdelivr.net/highlight.js/8.4/highlight.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</body>
</html>