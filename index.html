<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
		<head>
		<meta content="en-au" http-equiv="Content-Language" />
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Blog Feed" />
		<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Blog Feed" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<title>Kb</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css" />
		<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/8.4/styles/default.min.css">
		<link rel="shortcut icon" href="/img/favicon.ico" />
	</head>

	<body>
	    <!-- Google Tag Manager -->
		<noscript>
			<iframe src="//www.googletagmanager.com/ns.html?id=GTM-TQXXF7"
					height="0" width="0" style="display:none;visibility:hidden"></iframe>
		</noscript>
		<script>
			(function (w, d, s, l, i) {
				w[l] = w[l] || []; w[l].push({
					'gtm.start':
					new Date().getTime(), event: 'gtm.js'
				}); var f = d.getElementsByTagName(s)[0],
				j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
				'//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
			})(window, document, 'script', 'dataLayer', 'GTM-TQXXF7');</script>
		<!-- End Google Tag Manager -->
		<div id="container">
			<div id="side">
				<div id="hometext"><a href="/" id="home" title="Kb" alt="Kb">Kb</a></div>
				<div class="section">
					<ul>
						<li><a href="/Siigaa.html">西瓜跟踪<br/>Siigaa Tracker</a></li>
						<li>&nbsp;</li>
						<li><a href="/rss.xml"><img src="/img/25.png" /> feed</a></li>
					</ul>
				</div>
			</div>
			<div id="content">
				<ul class="posts">
    
		<li>
			<div class="idea">
				
					<h1><a href="/2016/03/06/Hello-From-Engine.html">Hello From Engine</a></h1>
					<div class="postdate"> 6 March, 2016
						<ul>
						
						</ul>
					</div>
					<p>This is the first test from the engine. Markdown file still added manually. But generating static site and git actions are all done automatically by web application.</p>
<p>And basically those are all the code (Configuration is a copy from Pretzel library since it's internal):</p>
<pre><code class="language-c">            var path = Server.MapPath(&quot;~/Yard/In&quot;);
            var destPath = Server.MapPath(&quot;~/Yard/Out&quot;);

            var fileSystem = new FileSystem();
            var contextGenerator = new SiteContextGenerator(fileSystem, new LinkHelper(), new BLL.Configuration(fileSystem, path));
            var siteContext = contextGenerator.BuildContext(path, destPath, false);
            var transforms = new List&lt;ITransform&gt;();
            transforms.Add(new LessTransform(fileSystem));
            transforms.Add(new VirtualDirectorySupport(fileSystem));
            var engine = new LiquidEngine();
            engine.FileSystem = fileSystem;
            engine.Initialize();
            engine.Process(siteContext);
            foreach (var t in transforms){
                t.Transform(siteContext);
            }
            engine.CompressSitemap(siteContext, fileSystem);

            using (var repo = new Repository(destPath))
            {
                repo.Stage(&quot;*&quot;);
                var author = new Signature(&quot;xxx&quot;, &quot;@xxxx&quot;, DateTime.Now);
                var committer = author;
                try
                {
                    var commit = repo.Commit(&quot;xxxxxx&quot;, author, committer);
                }
                catch (Exception ex)
                {
                    //do sth later
                }

                var remote = repo.Network.Remotes[&quot;origin&quot;];
                var options = new PushOptions();
                options.CredentialsProvider = (_url, _user, _cred) =&gt;
                    new UsernamePasswordCredentials { Username = &quot;xxxxx&quot;, Password = &quot;xxxx&quot; };
                repo.Network.Push(remote, @&quot;refs/heads/master&quot;, options);
            }
</code></pre>
<p>It's very basic though. But good to know that this works.</p>
					<br />
					<a href="/2016/03/06/Hello-From-Engine.html#disqus_thread">Comments</a>
				
			</div>
		</li>
    
		<li>
			<div class="idea">
				
					<h2><a class="postlink" href="/2016/03/05/New-Back-Engine-For-Blog.html">A New Back Engine for Blog</a></h2>
					<div class="postdate"> 5 March, 2016
						<ul>
						
						</ul>
					</div>
					<p>In order to stick to my previous post which states that I will not change the blog platform anymore but focus on writing content. I came up with an idea that to create an Asp.Net website to edit markdown files, generates the html site, then use git to commit to Github.</p>
<p>I know, kind of ridiculous. Why do I bother? Just setup a dynamic blog!</p>
<p>But you know, we, developers, always do stuff just because... we can...</p>
<p>Of course there're more genuine reasons:</p>
<ol>
<li>Tiered of changing blog platform, will try to keep it as static html site from now on.</li>
<li>Can utilize Github Page and Azure free App Service. Not saying hosting a website is too much money, just don't feel it's worth the money for me.</li>
<li>As a practice for Asp.Net 5(or Core 1?)</li>
</ol>
<p>Did a quick research, this is achievable with the following libraries/tools:</p>
<ol>
<li>libgit2sharp - git api in C sharp - https://github.com/libgit2/libgit2sharp/</li>
<li>pretzel - static html site generator in C sharp - https://github.com/Code52/pretzel</li>
</ol>
<p>And a online markdown editor and file management definitely exist.</p>
					<a href="/2016/03/05/New-Back-Engine-For-Blog.html#disqus_thread">Comments</a>
				
			</div>
		</li>
    
		<li>
			<div class="idea">
				
					<h2><a class="postlink" href="/2016/01/29/AnyoneHue-Monitor-multiple-people-with-WIFI-for-Philips-Hue-controlling.html">AnyoneHue? - Monitor multiple people with WIFI for Philips Hue controlling</a></h2>
					<div class="postdate">29 January, 2016
						<ul>
						
						</ul>
					</div>
					<p>Quite happy with Philips Hue 2nd Generation I recently bought (From Amazon Us, not available in Australia yet). Especially with Siri, although my wife is not very impressed because she can't just use the wall switch now XD.</p>
<p>Anyway, pretty good stuff for first step into Smart Home Automation, however it does give me a feeling that it's designed for single people who lives along :( Because Siri can't be shared between different Apple ID and Geo Fencing only works for a single device.</p>
<p>Siri issue can be resolved by setting up an iOS device at home only for home automation with &quot;Hey Siri&quot; enabled. But Geo Fencing is pretty much useless for me.</p>
<p>So I wrote a Windows Console Application that pings mine and my wife's iPhone every few seconds and turn the lights off or on accordingly.</p>
<p>Few things before we continue:</p>
<ul>
<li>It runs on windows, you need to have a windows machine that is always on when you want it to do the work.</li>
<li>You need to know your Bridge IP address and device names of the devices you want to monitor.</li>
<li>You need to follow Philips Developer Guide to setup API Key for your local Bridge.</li>
</ul>
<p>UI and non-tech people friendly version will come, but not much free time at the moment, will try.</p>
<h3>App Name: Anyone Hue ?</h3>
<p>Download Link: <a href="/files/AnyoneHue_Console_v1.0.zip">Direct</a></p>
<p>Main functionalities:</p>
<ul>
<li>Check multiple devices presence in local network and turn off all lights when none is connected (It's like GEO fencing for multiple people, but instead of using location, it uses wifi)</li>
<li>If any device comes back online, turn on a pre-defined light to full brightness</li>
<li>Can stop monitoring for particular hours defined in config, it enters sleep mode for those hours.</li>
<li>Can set retry numbers and retry waiting period</li>
</ul>
<p>Below is the web.config setting, hopefully can help you understands what are configurable for the app.</p>
<pre><code class="language-xml">	&lt;!-- Device names to be monitored--&gt;
    &lt;add key=&quot;DeviceNamesByPipes&quot; value=&quot;Device1|Device2&quot; /&gt;	
	&lt;!-- Ref to http://www.developers.meethue.com/documentation/getting-started to get an API key from your bridge --&gt;
    &lt;add key=&quot;HueBridgeApiKey&quot; value=&quot;APIKey&quot; /&gt;
    &lt;add key=&quot;HueBridgeIpAddress&quot; value=&quot;192.168.2.X&quot; /&gt;
	&lt;add key=&quot;LightNameToTurnOn&quot; value=&quot;LightName&quot; /&gt;	
    &lt;add key=&quot;CheckIntervalInSeconds&quot; value=&quot;5&quot; /&gt;
    &lt;add key=&quot;PingTimeoutInSeconds&quot; value=&quot;1000&quot; /&gt;    
    &lt;add key=&quot;RetryNumber&quot; value=&quot;3&quot; /&gt;
    &lt;add key=&quot;RetryIntervalInSeconds&quot; value=&quot;60&quot; /&gt;	
	&lt;!-- Active hours in a day, value can be 0 to 23 --&gt;
    &lt;add key=&quot;ActiveHours&quot; value=&quot;20,21,22,23&quot; /&gt;
	&lt;!-- Log file name will be appended with date --&gt;
    &lt;add key=&quot;LogFileName&quot; value=&quot;Scanlog&quot; /&gt;
	&lt;!-- Only supports /24 subnet, value can be 0 to 254 --&gt;
    &lt;add key=&quot;ScanStartIp&quot; value=&quot;0&quot; /&gt;
    &lt;add key=&quot;ScanEndIp&quot; value=&quot;254&quot; /&gt;
</code></pre>
					<a href="/2016/01/29/AnyoneHue-Monitor-multiple-people-with-WIFI-for-Philips-Hue-controlling.html#disqus_thread">Comments</a>
				
			</div>
		</li>
    
		<li>
			<div class="idea">
				
					<h2><a class="postlink" href="/2016/01/07/Converting-Chinese-to-Pinyin-in-Xamarin-IOS.html">Converting Chinese to Pinyin/Quanpin in Xamarin IOS development</a></h2>
					<div class="postdate"> 7 January, 2016
						<ul>
						
						</ul>
					</div>
					<p>For an IOS app with Chinese names, the names have to be sorted via Pinyin(it's like phonetic words), or people can barely locate anyone.</p>
<p>And there are lots of solutions on the internet about how to sort Chinese in Object-C, Swift or C#. However I couldn't find any on how to do it in Xamarin IOS using C#. All the C# way won't work in the Xamarin IOS app althought it compiles happily. My understanding it's that Xamarin is just a mapping(I may put it too simple here) between languages, so whatever the .Net framework is doing based on the language do not get carried over to IOS.</p>
<p>Luickly I found the mapping that Xamarin specificliy created just for the sake of mapping libraries in Object-C: <a href="https://developer.xamarin.com/api/type/Foundation.NSMutableString/">Foundation.NSMutableString</a> and its method:</p>
<pre><code class="language-cssharp">ApplyTransform(NSStringTransform, Boolean, NSRange, out NSRange) : Boolean
</code></pre>
<p>The method converts Chinese into Pinyin with tones like this &quot;zhōng wén&quot;. In my code I created an extension to sort by, however I think creating a field in the database to hold Pinyin would be more ideal.</p>
<p>To note here I tried to created this as a property as part of the database model however since it's inside of a portable class library so it doesn't have the Foundation namespace so I couldn't, hence the extension.</p>
<pre><code class="language-csharp">using Foundation;
...
		public static string GetPinyin (this string input)
		{
			var output = new NSMutableString ();
			output.SetString (new NSString (input));
			var dumy = new NSRange ();
			output.ApplyTransform (NSStringTransform.MandarinToLatin, false, new NSRange (0, output.Length), out dumy);
			return output.ToString ();
		}
</code></pre>
<p>觉得这篇尤其需要堆积一点中文来提高SEO。</p>
<p>基本上问题就是中文通讯录的排序，在纯 IOS 和 C# 的开发环境里这都是很普通的事情，因为 Google 里搜下一大堆的。可是在 Xamarin 里用 C# 写 IOS 就不大一样了。 Object-C 和 Swift 都不能直接用，C# 的虽然可以写出来可以编译，但到了IOS那边是失效的因为框架里的功能是完全不一样的。</p>
<p>所幸 Xamarin 的人真的就写了几个纯粹为了对应的类，这里要用的是这个： <a href="https://developer.xamarin.com/api/type/Foundation.NSMutableString/">Foundation.NSMutableString</a>。</p>
<p>用了这个可以把中文全部转换成拼音并且还包括音调，不过对不住没找到怎么是不包括音调了。但是有了这个东西后，至少排序不成问题了。</p>
<p>我的感觉是肯定还有更好的办法，不过暂时就先这样吧。</p>
<p>My feeling is that this is not the best way, but for now, it works.</p>
					<a href="/2016/01/07/Converting-Chinese-to-Pinyin-in-Xamarin-IOS.html#disqus_thread">Comments</a>
				
			</div>
		</li>
    
		<li>
			<div class="idea">
				
					<h2><a class="postlink" href="/2015/10/11/Get-Sitecore-Item-SiteInfo.html">Get Sitecore Item SiteInfo</a></h2>
					<div class="postdate">11 October, 2015
						<ul>
						
						</ul>
					</div>
					<p>Problem rises when the site index contains items from multiple sites and they need to have accurate urls gengerated for the items returned. And in this case, one site is a descendant of another site in Sitecore content tree.</p>
<p>I got the idea from a post in <a href="http://stackoverflow.com/questions/14200864/how-to-find-out-with-which-sitecore-site-an-item-is-associated">stackoverflow</a>, however improved it a bit so it matches the site more accurately.</p>
<pre><code class="language-csharp">public static SiteInfo GetSite(this Item item)
{
	var siteInfoList = Sitecore.Configuration.Factory.GetSiteInfoList();

	SiteInfo currentSiteinfo = null;
	var matchLength = 0;
	foreach (var siteInfo in siteInfoList)
	{
		if (item.Paths.FullPath.StartsWith(siteInfo.RootPath, StringComparison.OrdinalIgnoreCase) &amp;&amp; siteInfo.RootPath.Length &gt; matchLength)
		{
			matchLength = siteInfo.RootPath.Length;
			currentSiteinfo = siteInfo;
		}
	}

	return currentSiteinfo;
}
</code></pre>
<p>Then you can use urlOption with Sitecore LinkManager to generate urls:</p>
<pre><code class="language-csharp">var urlOptions = UrlOptions.DefaultOptions;
var siteInfo = item.GetSite();
if (siteInfo != null)
{
	urlOptions.Site = new SiteContext(siteInfo);
}
var url = LinkManager.GetItemUrl(item, urlOptions);
</code></pre>
					<a href="/2015/10/11/Get-Sitecore-Item-SiteInfo.html#disqus_thread">Comments</a>
				
			</div>
		</li>
    
</ul>

<h3>OLDER</h3>
<ul class="postArchive">

	<li>
		<span class="olderpostdate"> 04 Jun </span> <a class="postlink" href="/2015/06/04/Root-Note-4-Android-Lollipop-5.0.1-Vodafone-Au.html">Root Australia Vodafone Samsung Galaxy Note 4(N910G) Android Lollipop 5.0.1</a>
	</li>

	<li>
		<span class="olderpostdate"> 28 Apr </span> <a class="postlink" href="/2015/04/28/Input-Method-On-Galaxy-Note-4-Keep-Reverting-Back-To-Default.html">Input Method On Galaxy Note 4 Keep Reverting Back To Default</a>
	</li>

	<li>
		<span class="olderpostdate"> 14 Apr </span> <a class="postlink" href="/2015/04/14/Onda-v820w-Dual-Os-flashing-android-Booting-to-droidboot-img-failed.html">Onda v820w flash os - Booting to droidboot.img failed</a>
	</li>

	<li>
		<span class="olderpostdate"> 24 Mar </span> <a class="postlink" href="/2015/03/24/Sitecore-session-timeout-quickly-1-min-when-not-logged-in.html">Sitecore session expires(timeout) quickly(1 min) when not logged in</a>
	</li>

	<li>
		<span class="olderpostdate"> 19 Mar </span> <a class="postlink" href="/2015/03/19/Chrome-request-page-twice.html">Browser requests page twice</a>
	</li>

	<li>
		<span class="olderpostdate"> 15 Mar </span> <a class="postlink" href="/2015/03/15/From-mobile.html">From mobile</a>
	</li>

	<li>
		<span class="olderpostdate"> 14 Mar </span> <a class="postlink" href="/2015/03/14/focusing-on-content.html">Focusing on content</a>
	</li>

	<li>
		<span class="olderpostdate"> 13 Jan </span> <a class="postlink" href="/2015/01/13/Section-references-in-Sitecore-config-files-with-ref-attribute.html">Section references in Sitecore config files with ref attribute</a>
	</li>

	<li>
		<span class="olderpostdate"> 11 Jan </span> <a class="postlink" href="/2015/01/11/Powerline-Ethernet-Adapters.html">Powerline Ethernet Adapters</a>
	</li>

	<li>
		<span class="olderpostdate"> 06 Jan </span> <a class="postlink" href="/2015/01/06/TDS-project-build-fail-in-Teamcity-with-VS-2012-runner.html">TDS project build fail in Teamcity with VS 2012 runner</a>
	</li>

	<li>
		<span class="olderpostdate"> 18 Dec </span> <a class="postlink" href="/2014/12/18/Sonos-with-Airsonos-on-Windows-and-Mac.html">Sonos with Airsonos on Windows and Mac</a>
	</li>

	<li>
		<span class="olderpostdate"> 17 Dec </span> <a class="postlink" href="/2014/12/17/Google-Tag-Manager-causing-placeholder-issues-in-IE-8.html">Google Tag Manager causing placeholder issues in IE 8</a>
	</li>

	<li>
		<span class="olderpostdate"> 13 Dec </span> <a class="postlink" href="/2014/12/13/IIS-Http-error-500.19-with-web.config.html">IIS Http error 500.19 with web.config</a>
	</li>

	<li>
		<span class="olderpostdate"> 13 Dec </span> <a class="postlink" href="/2014/12/13/Must-have-softwares-after-reinstalling-windows.html">Must have softwares after reinstalling windows</a>
	</li>

	<li>
		<span class="olderpostdate"> 11 Dec </span> <a class="postlink" href="/2014/12/11/Multi-Site-solution-deployments-in-Azure.html">Multi-Site solution deployments in Azure</a>
	</li>

	<li>
		<span class="olderpostdate"> 08 Dec </span> <a class="postlink" href="/2014/12/08/IncludeTemplates-and-ExcludeTemplates-warning-for-custom-index-of-Sitecore.html">IncludeTemplates and ExcludeTemplates warning for custom index of Sitecore</a>
	</li>

	<li>
		<span class="olderpostdate"> 08 Dec </span> <a class="postlink" href="/2014/12/08/Schedule-tasks-not-running-on-CDS-in-Sitecore.html">Schedule tasks not running on CDS in Sitecore</a>
	</li>

	<li>
		<span class="olderpostdate"> 07 Dec </span> <a class="postlink" href="/2014/12/07/Sitecore-Redirect-Manager.html">Sitecore Redirect Manager</a>
	</li>

	<li>
		<span class="olderpostdate"> 04 Dec </span> <a class="postlink" href="/2014/12/04/Sitecore-indexes-media-url-with-sitecore-shell.html">Sitecore Indexes media url with /sitecore/shell</a>
	</li>

</ul>

<script type="text/javascript">
//<![CDATA[
(function() {
    var links = document.getElementsByTagName('a');
    var query = '?';
    for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
        query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
    }
    }
    document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kezblog/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>
			</div>
		</div>
		<script src="//cdn.jsdelivr.net/highlight.js/8.4/highlight.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</body>
</html>